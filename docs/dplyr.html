<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Data Wrangling: dplyr | Introduction to Open Data Science</title>
  <meta name="description" content="This is official open data science training for the Ocean Health Index." />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Data Wrangling: dplyr | Introduction to Open Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is official open data science training for the Ocean Health Index." />
  <meta name="github-repo" content="ohi-science/data-science-training" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Data Wrangling: dplyr | Introduction to Open Data Science" />
  
  <meta name="twitter:description" content="This is official open data science training for the Ocean Health Index." />
  

<meta name="author" content="The Ocean Health Index Team" />


<meta name="date" content="2019-06-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ggplot2.html">
<link rel="next" href="tidyr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">OHI Data Science Training</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a><ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#what-to-expect"><i class="fa fa-check"></i><b>2.1</b> What to expect</a></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#what-youll-learn"><i class="fa fa-check"></i><b>2.2</b> What you’ll learn</a><ul>
<li class="chapter" data-level="2.2.1" data-path="overview.html"><a href="overview.html#tidy-data-workflow"><i class="fa fa-check"></i><b>2.2.1</b> Tidy data workflow</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#learning-with-data-that-are-not-your-own"><i class="fa fa-check"></i><b>2.3</b> Learning with data that are not your own</a></li>
<li class="chapter" data-level="2.4" data-path="overview.html"><a href="overview.html#emphasizing-collaboration"><i class="fa fa-check"></i><b>2.4</b> Emphasizing collaboration</a></li>
<li class="chapter" data-level="2.5" data-path="overview.html"><a href="overview.html#by-the-end-of-the-course"><i class="fa fa-check"></i><b>2.5</b> By the end of the course…</a></li>
<li class="chapter" data-level="2.6" data-path="overview.html"><a href="overview.html#prerequisites"><i class="fa fa-check"></i><b>2.6</b> Prerequisites</a></li>
<li class="chapter" data-level="2.7" data-path="overview.html"><a href="overview.html#credit"><i class="fa fa-check"></i><b>2.7</b> Credit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>3</b> R &amp; RStudio, RMarkdown</a><ul>
<li class="chapter" data-level="3.1" data-path="rstudio.html"><a href="rstudio.html#objectives-resources"><i class="fa fa-check"></i><b>3.1</b> Objectives &amp; Resources</a><ul>
<li class="chapter" data-level="3.1.1" data-path="rstudio.html"><a href="rstudio.html#objectives"><i class="fa fa-check"></i><b>3.1.1</b> Objectives</a></li>
<li class="chapter" data-level="3.1.2" data-path="rstudio.html"><a href="rstudio.html#resources"><i class="fa fa-check"></i><b>3.1.2</b> Resources</a></li>
<li class="chapter" data-level="3.1.3" data-path="rstudio.html"><a href="rstudio.html#data-and-packages"><i class="fa fa-check"></i><b>3.1.3</b> Data and packages</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rstudio.html"><a href="rstudio.html#why-learn-r-with-rstudio"><i class="fa fa-check"></i><b>3.2</b> Why learn R with RStudio</a></li>
<li class="chapter" data-level="3.3" data-path="rstudio.html"><a href="rstudio.html#r-at-the-console-rstudio-goodies"><i class="fa fa-check"></i><b>3.3</b> R at the console, RStudio goodies</a><ul>
<li class="chapter" data-level="3.3.1" data-path="rstudio.html"><a href="rstudio.html#error-messages-are-your-friends"><i class="fa fa-check"></i><b>3.3.1</b> Error messages are your friends</a></li>
<li class="chapter" data-level="3.3.2" data-path="rstudio.html"><a href="rstudio.html#logical-operators-and-expressions"><i class="fa fa-check"></i><b>3.3.2</b> Logical operators and expressions</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="rstudio.html"><a href="rstudio.html#your-turn"><i class="fa fa-check"></i><b>3.4</b> Your Turn</a></li>
<li class="chapter" data-level="3.5" data-path="rstudio.html"><a href="rstudio.html#r-functions-help-pages"><i class="fa fa-check"></i><b>3.5</b> R functions, help pages</a><ul>
<li class="chapter" data-level="3.5.1" data-path="rstudio.html"><a href="rstudio.html#your-turn-1"><i class="fa fa-check"></i><b>3.5.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="rstudio.html"><a href="rstudio.html#packages"><i class="fa fa-check"></i><b>3.6</b> Packages</a></li>
<li class="chapter" data-level="3.7" data-path="rstudio.html"><a href="rstudio.html#clearing-the-environment"><i class="fa fa-check"></i><b>3.7</b> Clearing the environment</a><ul>
<li class="chapter" data-level="3.7.1" data-path="rstudio.html"><a href="rstudio.html#your-turn-2"><i class="fa fa-check"></i><b>3.7.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="rstudio.html"><a href="rstudio.html#rmarkdown"><i class="fa fa-check"></i><b>3.8</b> RMarkdown</a><ul>
<li class="chapter" data-level="3.8.1" data-path="rstudio.html"><a href="rstudio.html#your-turn-3"><i class="fa fa-check"></i><b>3.8.1</b> Your Turn</a></li>
<li class="chapter" data-level="3.8.2" data-path="rstudio.html"><a href="rstudio.html#code-chunks"><i class="fa fa-check"></i><b>3.8.2</b> Code chunks</a></li>
<li class="chapter" data-level="3.8.3" data-path="rstudio.html"><a href="rstudio.html#your-turn-4"><i class="fa fa-check"></i><b>3.8.3</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="rstudio.html"><a href="rstudio.html#rmarkdown-video-1-minute"><i class="fa fa-check"></i><b>3.9</b> RMarkdown video (1-minute)</a></li>
<li class="chapter" data-level="3.10" data-path="rstudio.html"><a href="rstudio.html#troubleshooting"><i class="fa fa-check"></i><b>3.10</b> Troubleshooting</a><ul>
<li class="chapter" data-level="3.10.1" data-path="rstudio.html"><a href="rstudio.html#i-entered-a-command-and-nothings-happening"><i class="fa fa-check"></i><b>3.10.1</b> I entered a command and nothing’s happening</a></li>
<li class="chapter" data-level="3.10.2" data-path="rstudio.html"><a href="rstudio.html#how-do-i-update-rstudio"><i class="fa fa-check"></i><b>3.10.2</b> How do I update RStudio?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>4</b> GitHub</a><ul>
<li class="chapter" data-level="4.1" data-path="github.html"><a href="github.html#objectives-1"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="github.html"><a href="github.html#what-are-git-and-github"><i class="fa fa-check"></i><b>4.2</b> What are Git and Github?</a></li>
<li class="chapter" data-level="4.3" data-path="github.html"><a href="github.html#why-should-scientists-use-github"><i class="fa fa-check"></i><b>4.3</b> Why should scientists use GitHub?</a></li>
<li class="chapter" data-level="4.4" data-path="github.html"><a href="github.html#resources-1"><i class="fa fa-check"></i><b>4.4</b> Resources</a></li>
<li class="chapter" data-level="4.5" data-path="github.html"><a href="github.html#lets-get-started"><i class="fa fa-check"></i><b>4.5</b> Let’s get started</a><ul>
<li class="chapter" data-level="4.5.1" data-path="github.html"><a href="github.html#some-github-terminology"><i class="fa fa-check"></i><b>4.5.1</b> Some Github terminology</a></li>
<li class="chapter" data-level="4.5.2" data-path="github.html"><a href="github.html#setup-git-github"><i class="fa fa-check"></i><b>4.5.2</b> Setup Git &amp; GitHub</a></li>
<li class="chapter" data-level="4.5.3" data-path="github.html"><a href="github.html#create-a-repository-on-github.com"><i class="fa fa-check"></i><b>4.5.3</b> Create a repository on Github.com</a></li>
<li class="chapter" data-level="4.5.4" data-path="github.html"><a href="github.html#clone-your-repository-using-rstudio"><i class="fa fa-check"></i><b>4.5.4</b> Clone your repository using RStudio</a></li>
<li class="chapter" data-level="4.5.5" data-path="github.html"><a href="github.html#inspect-results"><i class="fa fa-check"></i><b>4.5.5</b> Inspect results</a></li>
<li class="chapter" data-level="4.5.6" data-path="github.html"><a href="github.html#add-files-to-our-local-repo"><i class="fa fa-check"></i><b>4.5.6</b> Add files to our local repo</a></li>
<li class="chapter" data-level="4.5.7" data-path="github.html"><a href="github.html#committing-your-changes-and-syncing-with-github.com"><i class="fa fa-check"></i><b>4.5.7</b> Committing your changes and syncing with GitHub.com</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="github.html"><a href="github.html#explore-remote-github"><i class="fa fa-check"></i><b>4.6</b> Explore remote Github</a></li>
<li class="chapter" data-level="4.7" data-path="github.html"><a href="github.html#going-back-in-time"><i class="fa fa-check"></i><b>4.7</b> Going back in time</a></li>
<li class="chapter" data-level="4.8" data-path="github.html"><a href="github.html#happy-git-with-r"><i class="fa fa-check"></i><b>4.8</b> Happy Git with R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>5</b> Visualizing: <code>ggplot2</code></a><ul>
<li class="chapter" data-level="5.1" data-path="ggplot2.html"><a href="ggplot2.html#why-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Why ggplot2?</a></li>
<li class="chapter" data-level="5.2" data-path="ggplot2.html"><a href="ggplot2.html#additional-resources-for-data-visualization-in-r"><i class="fa fa-check"></i><b>5.2</b> Additional resources for data visualization in R</a></li>
<li class="chapter" data-level="5.3" data-path="ggplot2.html"><a href="ggplot2.html#objectives-2"><i class="fa fa-check"></i><b>5.3</b> Objectives</a></li>
<li class="chapter" data-level="5.4" data-path="ggplot2.html"><a href="ggplot2.html#install-and-load-tidyverse"><i class="fa fa-check"></i><b>5.4</b> Install and load: <code>tidyverse</code></a></li>
<li class="chapter" data-level="5.5" data-path="ggplot2.html"><a href="ggplot2.html#load-and-explore-data"><i class="fa fa-check"></i><b>5.5</b> Load and explore data</a></li>
<li class="chapter" data-level="5.6" data-path="ggplot2.html"><a href="ggplot2.html#plotting-with-ggplot2"><i class="fa fa-check"></i><b>5.6</b> Plotting with <strong><code>ggplot2</code></strong></a><ul>
<li class="chapter" data-level="5.6.1" data-path="ggplot2.html"><a href="ggplot2.html#step-1-identify-the-dataframe"><i class="fa fa-check"></i><b>5.6.1</b> Step 1: Identify the dataframe</a></li>
<li class="chapter" data-level="5.6.2" data-path="ggplot2.html"><a href="ggplot2.html#step-2-identify-the-style-of-plot-you-want-to-create-i.e.-the-geom"><i class="fa fa-check"></i><b>5.6.2</b> Step 2: Identify the style of plot you want to create (i.e., the geom)</a></li>
<li class="chapter" data-level="5.6.3" data-path="ggplot2.html"><a href="ggplot2.html#step-3-customize-your-plot"><i class="fa fa-check"></i><b>5.6.3</b> Step 3: Customize your plot</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="ggplot2.html"><a href="ggplot2.html#saving-plots"><i class="fa fa-check"></i><b>5.7</b> Saving plots</a></li>
<li class="chapter" data-level="5.8" data-path="ggplot2.html"><a href="ggplot2.html#arranging-plots"><i class="fa fa-check"></i><b>5.8</b> Arranging plots</a></li>
<li class="chapter" data-level="5.9" data-path="ggplot2.html"><a href="ggplot2.html#interactive-plots"><i class="fa fa-check"></i><b>5.9</b> Interactive plots</a></li>
<li class="chapter" data-level="5.10" data-path="ggplot2.html"><a href="ggplot2.html#save-and-push-to-github"><i class="fa fa-check"></i><b>5.10</b> Save and push to GitHub</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>6</b> Data Wrangling: <code>dplyr</code></a><ul>
<li class="chapter" data-level="6.1" data-path="dplyr.html"><a href="dplyr.html#objectives-resources-1"><i class="fa fa-check"></i><b>6.1</b> Objectives &amp; Resources</a><ul>
<li class="chapter" data-level="6.1.1" data-path="dplyr.html"><a href="dplyr.html#objectives-3"><i class="fa fa-check"></i><b>6.1.1</b> Objectives</a></li>
<li class="chapter" data-level="6.1.2" data-path="dplyr.html"><a href="dplyr.html#resources-2"><i class="fa fa-check"></i><b>6.1.2</b> Resources</a></li>
<li class="chapter" data-level="6.1.3" data-path="dplyr.html"><a href="dplyr.html#data-and-packages-1"><i class="fa fa-check"></i><b>6.1.3</b> Data and packages</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="dplyr.html"><a href="dplyr.html#tidy-data"><i class="fa fa-check"></i><b>6.2</b> Tidy Data</a><ul>
<li class="chapter" data-level="6.2.1" data-path="dplyr.html"><a href="dplyr.html#setup"><i class="fa fa-check"></i><b>6.2.1</b> Setup</a></li>
<li class="chapter" data-level="6.2.2" data-path="dplyr.html"><a href="dplyr.html#load-tidyverse-which-has-dplyr-inside"><i class="fa fa-check"></i><b>6.2.2</b> load <code>tidyverse</code> (which has <code>dplyr</code> inside)</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="dplyr.html"><a href="dplyr.html#explore-the-gapminder-data.frame"><i class="fa fa-check"></i><b>6.3</b> Explore the gapminder data.frame</a><ul>
<li class="chapter" data-level="6.3.1" data-path="dplyr.html"><a href="dplyr.html#read-data-with-readrread_csv"><i class="fa fa-check"></i><b>6.3.1</b> read data with <code>readr::read_csv()</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="dplyr.html"><a href="dplyr.html#look-at-the-variables-inside-a-data.frame"><i class="fa fa-check"></i><b>6.3.2</b> Look at the variables inside a data.frame</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="dplyr.html"><a href="dplyr.html#dplyr-basics"><i class="fa fa-check"></i><b>6.4</b> <code>dplyr</code> basics</a></li>
<li class="chapter" data-level="6.5" data-path="dplyr.html"><a href="dplyr.html#filter-subsets-data-row-wise-observations."><i class="fa fa-check"></i><b>6.5</b> <code>filter()</code> subsets data row-wise (observations).</a></li>
<li class="chapter" data-level="6.6" data-path="dplyr.html"><a href="dplyr.html#your-turn-5"><i class="fa fa-check"></i><b>6.6</b> Your turn</a><ul>
<li class="chapter" data-level="6.6.1" data-path="dplyr.html"><a href="dplyr.html#answer"><i class="fa fa-check"></i><b>6.6.1</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="dplyr.html"><a href="dplyr.html#select-subsets-data-column-wise-variables"><i class="fa fa-check"></i><b>6.7</b> <code>select()</code> subsets data column-wise (variables)</a></li>
<li class="chapter" data-level="6.8" data-path="dplyr.html"><a href="dplyr.html#use-select-and-filter-together"><i class="fa fa-check"></i><b>6.8</b> Use <code>select()</code> and <code>filter()</code> together</a></li>
<li class="chapter" data-level="6.9" data-path="dplyr.html"><a href="dplyr.html#meet-the-new-pipe-operator"><i class="fa fa-check"></i><b>6.9</b> Meet the new pipe <code>%&gt;%</code> operator</a><ul>
<li class="chapter" data-level="6.9.1" data-path="dplyr.html"><a href="dplyr.html#revel-in-the-convenience"><i class="fa fa-check"></i><b>6.9.1</b> Revel in the convenience</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="dplyr.html"><a href="dplyr.html#mutate-adds-new-variables"><i class="fa fa-check"></i><b>6.10</b> <code>mutate()</code> adds new variables</a><ul>
<li class="chapter" data-level="6.10.1" data-path="dplyr.html"><a href="dplyr.html#your-turn-6"><i class="fa fa-check"></i><b>6.10.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="6.11" data-path="dplyr.html"><a href="dplyr.html#group_by-operates-on-groups"><i class="fa fa-check"></i><b>6.11</b> <code>group_by()</code> operates on groups</a><ul>
<li class="chapter" data-level="6.11.1" data-path="dplyr.html"><a href="dplyr.html#summarize-with-group_by"><i class="fa fa-check"></i><b>6.11.1</b> <code>summarize()</code> with <code>group_by()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.12" data-path="dplyr.html"><a href="dplyr.html#arrange-orders-columns"><i class="fa fa-check"></i><b>6.12</b> <code>arrange()</code> orders columns</a><ul>
<li class="chapter" data-level="6.12.1" data-path="dplyr.html"><a href="dplyr.html#your-turn-7"><i class="fa fa-check"></i><b>6.12.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="6.13" data-path="dplyr.html"><a href="dplyr.html#all-together-now"><i class="fa fa-check"></i><b>6.13</b> All together now</a><ul>
<li class="chapter" data-level="6.13.1" data-path="dplyr.html"><a href="dplyr.html#compare-to-base-r"><i class="fa fa-check"></i><b>6.13.1</b> Compare to base R</a></li>
<li class="chapter" data-level="6.13.2" data-path="dplyr.html"><a href="dplyr.html#your-turn-8"><i class="fa fa-check"></i><b>6.13.2</b> Your Turn</a></li>
</ul></li>
<li class="chapter" data-level="6.14" data-path="dplyr.html"><a href="dplyr.html#joining-datasets"><i class="fa fa-check"></i><b>6.14</b> Joining datasets</a></li>
<li class="chapter" data-level="6.15" data-path="dplyr.html"><a href="dplyr.html#key-points"><i class="fa fa-check"></i><b>6.15</b> Key Points</a></li>
<li class="chapter" data-level="6.16" data-path="dplyr.html"><a href="dplyr.html#troubleshooting."><i class="fa fa-check"></i><b>6.16</b> Troubleshooting.</a><ul>
<li class="chapter" data-level="6.16.1" data-path="dplyr.html"><a href="dplyr.html#error-unexpected-special-in"><i class="fa fa-check"></i><b>6.16.1</b> Error: unexpected SPECIAL in &quot; %&gt;%&quot;</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>7</b> Data Wrangling: <code>tidyr</code></a><ul>
<li class="chapter" data-level="7.1" data-path="tidyr.html"><a href="tidyr.html#objectives-resources-2"><i class="fa fa-check"></i><b>7.1</b> Objectives &amp; Resources</a><ul>
<li class="chapter" data-level="7.1.1" data-path="tidyr.html"><a href="tidyr.html#objectives-4"><i class="fa fa-check"></i><b>7.1.1</b> Objectives</a></li>
<li class="chapter" data-level="7.1.2" data-path="tidyr.html"><a href="tidyr.html#resources-3"><i class="fa fa-check"></i><b>7.1.2</b> Resources</a></li>
<li class="chapter" data-level="7.1.3" data-path="tidyr.html"><a href="tidyr.html#data-and-packages-2"><i class="fa fa-check"></i><b>7.1.3</b> Data and packages</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="tidyr.html"><a href="tidyr.html#tidyr-basics"><i class="fa fa-check"></i><b>7.2</b> <code>tidyr</code> basics</a></li>
<li class="chapter" data-level="7.3" data-path="tidyr.html"><a href="tidyr.html#explore-gapminder-dataset."><i class="fa fa-check"></i><b>7.3</b> Explore gapminder dataset.</a><ul>
<li class="chapter" data-level="7.3.1" data-path="tidyr.html"><a href="tidyr.html#setup-1"><i class="fa fa-check"></i><b>7.3.1</b> Setup</a></li>
<li class="chapter" data-level="7.3.2" data-path="tidyr.html"><a href="tidyr.html#load-tidyverse-which-has-tidyr-inside"><i class="fa fa-check"></i><b>7.3.2</b> load <code>tidyverse</code> (which has <code>tidyr</code> inside)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="tidyr.html"><a href="tidyr.html#gather-data-from-wide-to-long-format"><i class="fa fa-check"></i><b>7.4</b> <code>gather()</code> data from wide to long format</a></li>
<li class="chapter" data-level="7.5" data-path="tidyr.html"><a href="tidyr.html#plot-long-format-data"><i class="fa fa-check"></i><b>7.5</b> Plot long format data</a></li>
<li class="chapter" data-level="7.6" data-path="tidyr.html"><a href="tidyr.html#spread"><i class="fa fa-check"></i><b>7.6</b> <code>spread()</code></a><ul>
<li class="chapter" data-level="7.6.1" data-path="tidyr.html"><a href="tidyr.html#answer-no-peeking-1"><i class="fa fa-check"></i><b>7.6.1</b> Answer (no peeking)</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="tidyr.html"><a href="tidyr.html#clean-up-and-save-your-.rmd"><i class="fa fa-check"></i><b>7.7</b> clean up and save your .Rmd</a><ul>
<li class="chapter" data-level="7.7.1" data-path="tidyr.html"><a href="tidyr.html#complete"><i class="fa fa-check"></i><b>7.7.1</b> <code>complete()</code></a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="tidyr.html"><a href="tidyr.html#other-links"><i class="fa fa-check"></i><b>7.8</b> Other links</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>8</b> Programming in R</a><ul>
<li class="chapter" data-level="8.1" data-path="programming.html"><a href="programming.html#objectives-resources-3"><i class="fa fa-check"></i><b>8.1</b> Objectives &amp; Resources</a><ul>
<li class="chapter" data-level="8.1.1" data-path="programming.html"><a href="programming.html#objectives-5"><i class="fa fa-check"></i><b>8.1.1</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="programming.html"><a href="programming.html#analysis-plan"><i class="fa fa-check"></i><b>8.2</b> Analysis plan</a></li>
<li class="chapter" data-level="8.3" data-path="programming.html"><a href="programming.html#create-an-r-script"><i class="fa fa-check"></i><b>8.3</b> Create an R script</a></li>
<li class="chapter" data-level="8.4" data-path="programming.html"><a href="programming.html#automation-with-for-loops"><i class="fa fa-check"></i><b>8.4</b> Automation with for loops</a><ul>
<li class="chapter" data-level="8.4.1" data-path="programming.html"><a href="programming.html#thinking-ahead-cleaning-up-our-code"><i class="fa fa-check"></i><b>8.4.1</b> Thinking ahead: cleaning up our code</a></li>
<li class="chapter" data-level="8.4.2" data-path="programming.html"><a href="programming.html#for-loop-basic-structure"><i class="fa fa-check"></i><b>8.4.2</b> For loop basic structure</a></li>
<li class="chapter" data-level="8.4.3" data-path="programming.html"><a href="programming.html#executable-for-loop"><i class="fa fa-check"></i><b>8.4.3</b> Executable for loop!</a></li>
<li class="chapter" data-level="8.4.4" data-path="programming.html"><a href="programming.html#clean-up-our-repo"><i class="fa fa-check"></i><b>8.4.4</b> Clean up our repo</a></li>
<li class="chapter" data-level="8.4.5" data-path="programming.html"><a href="programming.html#your-turn-9"><i class="fa fa-check"></i><b>8.4.5</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="programming.html"><a href="programming.html#conditional-statements-with-if-and-else"><i class="fa fa-check"></i><b>8.5</b> Conditional statements with <code>if</code> and <code>else</code></a><ul>
<li class="chapter" data-level="8.5.1" data-path="programming.html"><a href="programming.html#if-statement-basic-structure"><i class="fa fa-check"></i><b>8.5.1</b> if statement basic structure</a></li>
<li class="chapter" data-level="8.5.2" data-path="programming.html"><a href="programming.html#executable-if-statement"><i class="fa fa-check"></i><b>8.5.2</b> Executable if statement</a></li>
<li class="chapter" data-level="8.5.3" data-path="programming.html"><a href="programming.html#executable-ifelse-statement"><i class="fa fa-check"></i><b>8.5.3</b> Executable if/else statement</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="programming.html"><a href="programming.html#more-r"><i class="fa fa-check"></i><b>8.6</b> More R!</a><ul>
<li class="chapter" data-level="8.6.1" data-path="programming.html"><a href="programming.html#importing-and-installing"><i class="fa fa-check"></i><b>8.6.1</b> Importing and Installing</a></li>
<li class="chapter" data-level="8.6.2" data-path="programming.html"><a href="programming.html#organization-and-workflows"><i class="fa fa-check"></i><b>8.6.2</b> Organization and workflows</a></li>
<li class="chapter" data-level="8.6.3" data-path="programming.html"><a href="programming.html#getting-help"><i class="fa fa-check"></i><b>8.6.3</b> Getting help</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="programming.html"><a href="programming.html#ideas-for-extended-analysis-2"><i class="fa fa-check"></i><b>8.7</b> Ideas for Extended Analysis 2</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="collaborating.html"><a href="collaborating.html"><i class="fa fa-check"></i><b>9</b> Collaborating with GitHub</a><ul>
<li class="chapter" data-level="9.1" data-path="collaborating.html"><a href="collaborating.html#objectives-resources-4"><i class="fa fa-check"></i><b>9.1</b> Objectives &amp; Resources</a><ul>
<li class="chapter" data-level="9.1.1" data-path="collaborating.html"><a href="collaborating.html#objectives-6"><i class="fa fa-check"></i><b>9.1.1</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="collaborating.html"><a href="collaborating.html#create-repo-partner-1"><i class="fa fa-check"></i><b>9.2</b> Create repo (Partner 1)</a></li>
<li class="chapter" data-level="9.3" data-path="collaborating.html"><a href="collaborating.html#create-a-gh-pages-branch-partner-1"><i class="fa fa-check"></i><b>9.3</b> Create a gh-pages branch (Partner 1)</a></li>
<li class="chapter" data-level="9.4" data-path="collaborating.html"><a href="collaborating.html#give-your-collaborator-administration-privileges-partner-1-and-2"><i class="fa fa-check"></i><b>9.4</b> Give your collaborator administration privileges (Partner 1 and 2)</a></li>
<li class="chapter" data-level="9.5" data-path="collaborating.html"><a href="collaborating.html#clone-to-a-new-rproject-partner-1"><i class="fa fa-check"></i><b>9.5</b> Clone to a new Rproject (Partner 1)</a></li>
<li class="chapter" data-level="9.6" data-path="collaborating.html"><a href="collaborating.html#clone-to-a-new-rproject-partner-2"><i class="fa fa-check"></i><b>9.6</b> Clone to a new Rproject (Partner 2)</a></li>
<li class="chapter" data-level="9.7" data-path="collaborating.html"><a href="collaborating.html#edit-a-file-and-sync-partner-2"><i class="fa fa-check"></i><b>9.7</b> Edit a file and sync (Partner 2)</a></li>
<li class="chapter" data-level="9.8" data-path="collaborating.html"><a href="collaborating.html#state-of-the-repository"><i class="fa fa-check"></i><b>9.8</b> State of the Repository</a></li>
<li class="chapter" data-level="9.9" data-path="collaborating.html"><a href="collaborating.html#merge-conflicts"><i class="fa fa-check"></i><b>9.9</b> Merge conflicts</a><ul>
<li class="chapter" data-level="9.9.1" data-path="collaborating.html"><a href="collaborating.html#your-turn-10"><i class="fa fa-check"></i><b>9.9.1</b> Your turn</a></li>
</ul></li>
<li class="chapter" data-level="9.10" data-path="collaborating.html"><a href="collaborating.html#how-do-you-avoid-merge-conflicts"><i class="fa fa-check"></i><b>9.10</b> How do you avoid merge conflicts?</a></li>
<li class="chapter" data-level="9.11" data-path="collaborating.html"><a href="collaborating.html#create-your-collaborative-website"><i class="fa fa-check"></i><b>9.11</b> Create your collaborative website</a></li>
<li class="chapter" data-level="9.12" data-path="collaborating.html"><a href="collaborating.html#your-turn-11"><i class="fa fa-check"></i><b>9.12</b> Your turn</a></li>
<li class="chapter" data-level="9.13" data-path="collaborating.html"><a href="collaborating.html#explore-on-github.com"><i class="fa fa-check"></i><b>9.13</b> Explore on GitHub.com</a><ul>
<li class="chapter" data-level="9.13.1" data-path="collaborating.html"><a href="collaborating.html#commit-history"><i class="fa fa-check"></i><b>9.13.1</b> Commit History</a></li>
<li class="chapter" data-level="9.13.2" data-path="collaborating.html"><a href="collaborating.html#blame"><i class="fa fa-check"></i><b>9.13.2</b> Blame</a></li>
<li class="chapter" data-level="9.13.3" data-path="collaborating.html"><a href="collaborating.html#issues"><i class="fa fa-check"></i><b>9.13.3</b> Issues</a></li>
</ul></li>
<li class="chapter" data-level="9.14" data-path="collaborating.html"><a href="collaborating.html#nyc-flights-exploration"><i class="fa fa-check"></i><b>9.14</b> NYC flights exploration</a><ul>
<li class="chapter" data-level="9.14.1" data-path="collaborating.html"><a href="collaborating.html#logical-operators"><i class="fa fa-check"></i><b>9.14.1</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="9.15" data-path="collaborating.html"><a href="collaborating.html#your-turn-12"><i class="fa fa-check"></i><b>9.15</b> Your turn</a><ul>
<li class="chapter" data-level="9.15.1" data-path="collaborating.html"><a href="collaborating.html#use-logicals"><i class="fa fa-check"></i><b>9.15.1</b> Use logicals</a></li>
<li class="chapter" data-level="9.15.2" data-path="collaborating.html"><a href="collaborating.html#missing-values"><i class="fa fa-check"></i><b>9.15.2</b> Missing values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="champion.html"><a href="champion.html"><i class="fa fa-check"></i><b>10</b> Be a champion for open science</a><ul>
<li class="chapter" data-level="10.1" data-path="champion.html"><a href="champion.html#objectives-and-resources"><i class="fa fa-check"></i><b>10.1</b> Objectives and Resources</a></li>
<li class="chapter" data-level="10.2" data-path="champion.html"><a href="champion.html#three-messages"><i class="fa fa-check"></i><b>10.2</b> Three messages</a></li>
<li class="chapter" data-level="10.3" data-path="champion.html"><a href="champion.html#build-community"><i class="fa fa-check"></i><b>10.3</b> Build community</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Open Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Data Wrangling: <code>dplyr</code></h1>
<blockquote>
<p>Data scientists, according to interviews and expert estimates, spend from 50 percent to 80 percent of their time mired in the mundane labor of collecting and preparing data, before it can be explored for useful information. - <a href="http://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html">NYTimes (2014)</a></p>
</blockquote>
<div id="objectives-resources-1" class="section level2">
<h2><span class="header-section-number">6.1</span> Objectives &amp; Resources</h2>
<p>What are some common things you like to do with your data? Maybe remove rows or columns, do calculations and maybe add new columns? This is called <strong>data wrangling</strong>. It’s not data management or data manipulation: you <strong>keep the raw data raw</strong> and do these things programatically in R with the tidyverse.</p>
<p>We are going to introduce you to data wrangling in R first with the tidyverse. The tidyverse is a new suite of packages that match a philosophy of data science developed by Hadley Wickham and the RStudio team. I find it to be a more straight-forward way to learn R. We will also show you by comparison what code will look like in “Base R”, which means, in R without any additional packages (like the “tidyverse” package) installed. I like David Robinson’s blog post on the topic of <a href="http://varianceexplained.org/r/teach-hard-way">teaching the tidyverse first</a>.</p>
<p>For some things, base-R is more straight forward, and we’ll show you that too. Whenever we use a function that is from the tidyverse, we will prefix it so you’ll know for sure.</p>
<div id="objectives-3" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Objectives</h3>
<ul>
<li>discuss tidy data</li>
<li>read data from online into R</li>
<li>explore <code>gapminder</code> data with base-R functions</li>
<li>wrangle <code>gapminder</code> data with <code>dplyr</code> tidyverse functions</li>
<li>practice RStudio-GitHub workflow</li>
</ul>
</div>
<div id="resources-2" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Resources</h3>
<p>Today’s materials are again borrowing from some excellent sources, including:</p>
<ul>
<li>Jenny Bryan’s lectures from STAT545 at UBC: <a href="http://stat545.com/block009_dplyr-intro.html">Introduction to dplyr</a></li>
<li>Hadley Wickham and Garrett Grolemund’s <a href="http://r4ds.had.co.nz/">R for Data Science</a></li>
<li>Software Carpentry’s R for reproducible scientific analysis materials: <a href="http://swcarpentry.github.io/r-novice-gapminder/13-dplyr.html">Dataframe manipulation with dplyr</a></li>
<li>First developed for <a href="http://remi-daigle.github.io/2016-04-15-UCSB/dplyr/">Software Carpentry at UCSB</a></li>
<li><a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">RStudio’s data wrangling cheatsheet</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/">RStudio’s data wrangling webinar</a></li>
</ul>
</div>
<div id="data-and-packages-1" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Data and packages</h3>
<p><strong>Gapminder data</strong></p>
<p>We’ll be using <a href="http://www.gapminder.org/world">Gapminder data</a>, which represents the health and wealth of nations. It was pioneered by <a href="https://www.ted.com/speakers/hans_rosling">Hans Rosling</a>, who is famous for describing the prosperity of nations over time through famines, wars and other historic events with this beautiful data visualization in his <a href="https://www.ted.com/talks/hans_rosling_shows_the_best_stats_you_ve_ever_seen">2006 TED Talk: The best stats you’ve ever seen</a>:</p>
<p><a href="http://www.gapminder.org/world">Gapminder Motion Chart&lt;br&gt;<img src="https://github.com/remi-daigle/2016-04-15-UCSB/raw/gh-pages/viz/img/gapminder-world_motion-chart.png" /></a></p>
<p>We’ll use the package <code>dplyr</code>, which is bundled within the <code>tidyverse</code> package. Please install the <code>tidyverse</code> ahead of time:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre>
</div>
</div>
<div id="tidy-data" class="section level2">
<h2><span class="header-section-number">6.2</span> Tidy Data</h2>
<p>Let’s start off discussing Tidy Data.</p>
<p>Hadley Wickham, RStudio’s Chief Scientist, and his team have been building R packages for data wrangling and visualization based on the idea of <strong>tidy data</strong>.</p>
<p>Tidy data has a simple convention: put variables in the columns and observations in the rows.</p>
<p><img src="img/tidy_data.png" />
</br>
</br>
The national parks dataset we were working with this morning was an example of tidy data. When data are tidy, you are set up to work with it for your analyses, plots, etc.
</br>
</br>
<img src="img/tidy_img_np.png" /></p>
<p>Right now we are going to use <code>dplyr</code> to wrangle this tidy-ish data set (the transform part of the cycle), and then come back to tidying messy data using <code>tidyr</code> once we’ve had some fun wrangling. These are both part of the <code>tidyverse</code> package that we’ve already installed:</p>
<p><img src="img/r4ds_data-science.png" /></p>
<p><br></p>
<p>Conceptually, making data tidy first is really critical. Instead of building your analyses around whatever (likely weird) format your data are in, take deliberate steps to make your data tidy. When your data are tidy, you can use a growing assortment of powerful analytical and visualization tools instead of inventing home-grown ways to accommodate your data. This will save you time since you aren’t reinventing the wheel, and will make your work more clear and understandable to your collaborators (most importantly, Future You).</p>
<p>And actually, Hadley Wickham and RStudio have created a ton of packages that help you at every step of the way here. This is from one of Hadley’s recent presentations:</p>
<p><img src="img/tidyverse_wickham_pres.jpg" /></p>
<div id="setup" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Setup</h3>
<p>We’ll do this in a new RMarkdown file.</p>
<p><strong>Here’s what to do:</strong></p>
<ol style="list-style-type: decimal">
<li>Clear your workspace (Session &gt; Restart R)</li>
<li>New File &gt; R Markdown…</li>
<li>Save as <code>gapminder-wrangle.Rmd</code></li>
<li>Delete the irrelevant text and write a little note to yourself about how we’ll be wrangling gapminder data using dplyr. You can edit the title too if you need to.</li>
</ol>
</div>
<div id="load-tidyverse-which-has-dplyr-inside" class="section level3">
<h3><span class="header-section-number">6.2.2</span> load <code>tidyverse</code> (which has <code>dplyr</code> inside)</h3>
<p>In your R Markdown file, let’s make sure we’ve got our libraries loaded. Write the following:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)     <span class="co">## install.packages(&quot;tidyverse&quot;)</span></code></pre>
<p>This is becoming standard practice for how to load a library in a file, and if you get an error that the library doesn’t exist, you can install the package easily by running the code within the comment (highlight <code>install.packages(&quot;tidyverse&quot;)</code> and run it).</p>
</div>
</div>
<div id="explore-the-gapminder-data.frame" class="section level2">
<h2><span class="header-section-number">6.3</span> Explore the gapminder data.frame</h2>
<p>Yesterday we explored the national parks data.frame visually. Today, we’ll explore a dataset by the numbers.</p>
<p>We will work with some of the data from the <a href="http://www.gapminder.org">Gapminder project</a>.</p>
<p>The data are on GitHub. Navigate there by going to:</p>
<p>github.com &gt; ohi-science &gt; data-science-training &gt; data &gt; gapminder.csv</p>
<p>or by copy-pasting url for data-view: <code>https://github.com/OHI-Science/data-science-training/blob/master/data/gapminder.csv</code></p>
<p>This is data-view mode: so we can have a quick look at the data. It’s a .csv file, which you’ve probably encountered before, but GitHub has formatted it nicely so it’s easy to look at. You can see that for every country and year, there are several columns with data in them.</p>
<p><img src="img/gapminder_gh.png" /></p>
<div id="read-data-with-readrread_csv" class="section level3">
<h3><span class="header-section-number">6.3.1</span> read data with <code>readr::read_csv()</code></h3>
<p>We can read this data into R directly from GitHub, without downloading it. But we can’t read this data in view-mode. We have to click on the <strong>Raw button</strong> on the top-right of the data. This displays it as the raw csv file, without formatting.</p>
<p><img src="img/gapminder_gh_raw.png" /></p>
<p>Copy the url for raw data:</p>
<p><a href="https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/gapminder.csv" class="uri">https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/gapminder.csv</a></p>
<p>Now, let’s go back to RStudio. In our R Markdown, let’s read this csv file and name the variable “gapminder”. We will use the <code>read_csv()</code> function from the <code>readr</code> package (part of the tidyverse, so it’s already installed!).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## read gapminder csv. Note the readr:: prefix identifies which package it&#39;s in</span>
gapminder &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/gapminder.csv&#39;</span>) </code></pre>
<p>Note: <code>read_csv</code> works with local filepaths as well, you could use one from your computer.</p>
<p>Let’s inspect:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## explore the gapminder dataset</span>
gapminder <span class="co"># this is super long! Let&#39;s inspect in different ways</span></code></pre>
<p>Let’s use <code>head</code> and <code>tail</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(gapminder) <span class="co"># shows first 6</span>
<span class="kw">tail</span>(gapminder) <span class="co"># shows last 6</span>

<span class="kw">head</span>(gapminder, <span class="dv">10</span>) <span class="co"># shows first X that you indicate</span>
<span class="kw">tail</span>(gapminder, <span class="dv">12</span>) <span class="co"># guess what this does!</span></code></pre>
<p><code>str()</code> will provide a sensible description of almost anything: when in doubt, inspect using <code>str()</code> on some of the recently created objects to get some ideas about what to do next.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(gapminder) <span class="co"># ?str - displays the structure of an object</span></code></pre>
<p><code>gapminder</code> is a <code>data.frame</code>. We aren’t going to get into the other types of data receptacles today (‘arrays’, ‘matrices’), because working with data.frames is what you should primarily use. Why?</p>
<ul>
<li>data.frames package related variables neatly together, great for analysis</li>
<li>most functions, including the latest and greatest packages actually <strong>require</strong> that your data be in a data.frame</li>
<li>data.frames can hold variables of different flavors such as
<ul>
<li>character data (country or continent names; “Characters (chr)”)</li>
<li>quantitative data (years, population; “Integers (int)” or “Numeric (num)”)</li>
<li>categorical information (male vs. female)</li>
</ul></li>
</ul>
<p>We can also see the <code>gapminder</code> variable in RStudio’s Environment pane (top right)</p>
<p>More ways to learn basic info on a data.frame.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(gapminder)
<span class="kw">dim</span>(gapminder)    <span class="co"># ?dim dimension</span>
<span class="kw">ncol</span>(gapminder)   <span class="co"># ?ncol number of columns</span>
<span class="kw">nrow</span>(gapminder)   <span class="co"># ?nrow number of rows</span></code></pre>
<p>We can combine using <code>c()</code> to reverse-engineer <code>dim()</code>! It’s a side-note here, but I wanted to introduce you to <code>c()</code>: we’ll use it later.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="kw">nrow</span>(gapminder), <span class="kw">ncol</span>(gapminder)) <span class="co"># ?c combines values into a vector or list. </span></code></pre>
<p>A statistical overview can be obtained with <code>summary()</code>, or with <code>skimr::skim()</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(gapminder)

<span class="kw">library</span>(skimr) <span class="co"># install.packages(&#39;skimr&#39;)</span>
<span class="kw">skim</span>(gapminder)</code></pre>
</div>
<div id="look-at-the-variables-inside-a-data.frame" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Look at the variables inside a data.frame</h3>
<p>To specify a single variable from a data.frame, use the dollar sign <code>$</code>. The <code>$</code> operator is a way to extract of replace parts of an object — check out the help menu for <code>$</code>. It’s a common operator you’ll see in R.</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder<span class="op">$</span>lifeExp <span class="co"># very long! hard to make sense of...</span>
<span class="kw">head</span>(gapminder<span class="op">$</span>lifeExp) <span class="co"># can do the same tests we tried before</span>
<span class="kw">str</span>(gapminder<span class="op">$</span>lifeExp) <span class="co"># it is a single numeric vector</span>
<span class="kw">summary</span>(gapminder<span class="op">$</span>lifeExp) <span class="co"># same information, formatted slightly differently</span></code></pre>
</div>
</div>
<div id="dplyr-basics" class="section level2">
<h2><span class="header-section-number">6.4</span> <code>dplyr</code> basics</h2>
<p>OK, so let’s start wrangling with dplyr.</p>
<p>There are five <code>dplyr</code> functions that you will use to do the vast majority of data manipulations:</p>
<ul>
<li><p><strong><code>filter()</code></strong>: pick observations by their values</p>
<img src="img/rstudio-cheatsheet-filter.png" width="300"/></li>
<li><p><strong><code>select()</code></strong>: pick variables by their names</p>
<img src="img/rstudio-cheatsheet-select.png" width="300"/></li>
<li><p><strong><code>mutate()</code></strong>: create new variables with functions of existing variables</p>
<img src="img/rstudio-cheatsheet-mutate.png" width="300"/></li>
<li><p><strong><code>summarise()</code></strong>: collapse many values down to a single summary</p>
<img src="img/rstudio-cheatsheet-summarise.png" width="300"/></li>
<li><p><strong><code>arrange()</code></strong>: reorder the rows</p></li>
</ul>
<p>These can all be used in conjunction with <code>group_by()</code> which changes the scope of each function from operating on the entire dataset to operating on it group-by-group. These six functions provide the verbs for a language of data manipulation.</p>
<p>All verbs work similarly:</p>
<ol style="list-style-type: decimal">
<li>The first argument is a data frame.</li>
<li>The subsequent arguments describe what to do with the data frame. You can refer to columns in the data frame directly without using <code>$</code>.</li>
<li>The result is a new data frame.</li>
</ol>
<p>Together these properties make it easy to chain together multiple simple steps to achieve a complex result.</p>
</div>
<div id="filter-subsets-data-row-wise-observations." class="section level2">
<h2><span class="header-section-number">6.5</span> <code>filter()</code> subsets data row-wise (observations).</h2>
<p>You will want to isolate bits of your data; maybe you want to only look at a single country or a few years. R calls this subsetting.</p>
<p><code>filter()</code> is a function in <code>dplyr</code> that takes logical expressions and returns the rows for which all are <code>TRUE</code>.</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<p><img src="img/rstudio-cheatsheet-filter.png" />
Remember your logical expressions from this morning? We’ll use <code>&lt;</code> and <code>==</code> here.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, lifeExp <span class="op">&lt;</span><span class="st"> </span><span class="dv">29</span>)</code></pre>
<p>You can say this out loud: “Filter the gapminder data for life expectancy less than 29”. Notice that when we do this, all the columns are returned, but only the rows that have the life expectancy less than 29. We’ve subsetted by row.</p>
<p>Let’s try another: “Filter the gapminder data for the country Mexico”.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Mexico&quot;</span>)</code></pre>
<p>How about if we want two country names? We can’t use the <code>==</code> operator here, because it can only operate on one thing at a time. We will use the <code>%in%</code> operator:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mexico&quot;</span>, <span class="st">&quot;Peru&quot;</span>))</code></pre>
<p>How about if we want Mexico in 2002? You can pass filter different criteria:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Mexico&quot;</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">2002</span>)</code></pre>
</div>
<div id="your-turn-5" class="section level2">
<h2><span class="header-section-number">6.6</span> Your turn</h2>
<p>What is the mean life expectancy of Sweden? Hint: do this in 2 steps by assigning a variable and then using the <code>mean()</code> function.</p>
<p>Then, sync to Github.com (pull, stage, commit, push).</p>
<div id="answer" class="section level3">
<h3><span class="header-section-number">6.6.1</span> Answer</h3>
<p>This is one way to do it based on what we have learned so far:</p>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Sweden&quot;</span>)  
<span class="kw">mean</span>(x<span class="op">$</span>lifeExp)  </code></pre>
<!---Don't use this one for now because gets off track for %>%
2. Choose a country. How much has the population changed since the earliest record? Hint: create variables for the earliest and most recent years, and subtract from each other.  
x1 <- filter(gapminder, country == "Sweden", year == 1952)
x2 <- filter(gapminder, country == "Sweden", year == 2007)
x2$pop - x1$pop
##  1906415
--->
</div>
</div>
<div id="select-subsets-data-column-wise-variables" class="section level2">
<h2><span class="header-section-number">6.7</span> <code>select()</code> subsets data column-wise (variables)</h2>
<p>We use <code>select()</code> to subset the data on variables or columns.</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<p><img src="img/rstudio-cheatsheet-select.png" /></p>
<p>We can select multiple columns with a comma, after we specify the data frame (gapminder).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(gapminder, year, lifeExp) </code></pre>
<p>We can also use - to deselect columns</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(gapminder, <span class="op">-</span>continent, <span class="op">-</span>lifeExp) <span class="co"># you can use - to deselect columns</span></code></pre>
</div>
<div id="use-select-and-filter-together" class="section level2">
<h2><span class="header-section-number">6.8</span> Use <code>select()</code> and <code>filter()</code> together</h2>
<p>Let’s filter for Cambodia and remove the continent and lifeExp columns. We’ll save this as a variable. Actually, as two temporary variables, which means that for the second one we need to operate on <code>gap_cambodia</code>, not <code>gapminder</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">gap_cambodia  &lt;-<span class="st"> </span><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>)
gap_cambodia2 &lt;-<span class="st"> </span><span class="kw">select</span>(gap_cambodia, <span class="op">-</span>continent, <span class="op">-</span>lifeExp) </code></pre>
<p>We also could have called them both <code>gap_cambodia</code> and overwritten the first assignment. Either way, naming them and keeping track of them gets super cumbersome, which means more time to understand what’s going on and opportunities for confusion or error.</p>
<p>Good thing there is an awesome alternative.</p>
</div>
<div id="meet-the-new-pipe-operator" class="section level2">
<h2><span class="header-section-number">6.9</span> Meet the new pipe <code>%&gt;%</code> operator</h2>
<p>Before we go any further, we should exploit the new pipe operator that <code>dplyr</code> imports from the <a href="https://github.com/smbache/magrittr"><code>magrittr</code></a> package by Stefan Bache. <strong>This is going to change your life</strong>. You no longer need to enact multi-operation commands by nesting them inside each other. And we won’t need to make temporary variables like we did in the Cambodia example above. This new syntax leads to code that is much easier to write and to read: it actually tells the story of your analysis.</p>
<p>Here’s what it looks like: <code>%&gt;%</code>. The RStudio keyboard shortcut: Ctrl + Shift + M (Windows), Cmd + Shift + M (Mac).</p>
<p>Let’s demo then I’ll explain:</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<p>This is equivalent to <code>head(gapminder)</code>. This pipe operator takes the thing on the left-hand-side and <strong>pipes</strong> it into the function call on the right-hand-side. It literally drops it in as the first argument.</p>
<p>Never fear, you can still specify other arguments to this function! To see the first 3 rows of Gapminder, we could say <code>head(gapminder, 3)</code> or this:</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</code></pre>
<p><strong>I’ve advised you to think “gets” whenever you see the assignment operator, <code>&lt;-</code>. Similarly, you should think “and then” whenever you see the pipe operator, <code>%&gt;%</code>.</strong></p>
<p>One of the most awesome things about this is that you START with the data before you say what you’re doing to DO to it. So above: “take the gapminder data, and then give me the first three entries”.</p>
<p>This means that instead of this:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## instead of this...</span>
gap_cambodia  &lt;-<span class="st"> </span><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>)
gap_cambodia2 &lt;-<span class="st"> </span><span class="kw">select</span>(gap_cambodia, <span class="op">-</span>continent, <span class="op">-</span>lifeExp) 

<span class="co">## ...we can do this</span>
gap_cambodia  &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>)
gap_cambodia2 &lt;-<span class="st"> </span>gap_cambodia <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp) </code></pre>
<p>So you can see that we’ll start with gapminder in the first example line, and then gap_cambodia in the second. This makes it a bit easier to see what data we are starting with and what we are doing to it.</p>
<p>…But, we still have those temporary variables so we’re not truly that better off. But get ready to be majorly impressed:</p>
<!---
Fun break: check out [this gif about %>% from Twitter](https://twitter.com/backerman150/status/926479565869993984).
--->
<div id="revel-in-the-convenience" class="section level3">
<h3><span class="header-section-number">6.9.1</span> Revel in the convenience</h3>
<p>We can use the pipe to chain those two operations together:</p>
<pre class="sourceCode r"><code class="sourceCode r">gap_cambodia  &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp) </code></pre>
<p>What’s happening here? In the second line, we were able to delete <code>gap_cambodia2 &lt;- gap_cambodia</code>, and put the pipe operator above. This is possible since we wanted to operate on the <code>gap_cambodia</code> data anyways. And we weren’t truly excited about having a second variable named <code>gap_cambodia2</code> anyways, so we can get rid of it. This is huge, because most of your data wrangling will have many more than 2 steps, and we don’t want a <code>gap_cambodia14</code>!</p>
<p>Let’s write it again but using multiple lines so it’s nicer to read.</p>
<pre class="sourceCode r"><code class="sourceCode r">gap_cambodia  &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp) </code></pre>
<p>Amazing. I can actually read this like a story and there aren’t temporary variables that get super confusing. In my head:</p>
<blockquote>
<p>“start with the <code>gapminder</code> data, and then<br />
filter for Cambodia, and then<br />
deselect the variables continent and lifeExp.”</p>
</blockquote>
<p>Being able to read a story out of code like this is really game-changing. We’ll continue using this syntax as we learn the other dplyr verbs.</p>
</div>
</div>
<div id="mutate-adds-new-variables" class="section level2">
<h2><span class="header-section-number">6.10</span> <code>mutate()</code> adds new variables</h2>
<p>Alright, let’s keep going.</p>
<p>Let’s say we needed to add an index column so we know which order these data came in. Let’s not make a new variable, let’s add a column to our gapminder data frame. How do we do that? With the <code>mutate()</code> function.</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<p><img src="img/rstudio-cheatsheet-mutate.png" /></p>
<p>We will name our new column index. We will name the new column ‘index’; and we assign it with a single <code>=</code>. Notice that we can use the <code>nrow</code> function <em>within</em> our mutate call:</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">index =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(gapminder))</code></pre>
<p>OK, let’s do another example. Imagine we wanted to recover each country’s GDP. After all, the Gapminder data has a variable for population and GDP per capita.</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap)</code></pre>
<div id="your-turn-6" class="section level3">
<h3><span class="header-section-number">6.10.1</span> Your turn</h3>
<p>Find the maximum gdpPercap of Egypt and the maximum gdpPercap of Vietnam. Create a new column with <code>mutate()</code>. Hint: use <code>max()</code></p>
<p>Then, sync to Github.com (pull, stage, commit, push).</p>
<div id="answer-1" class="section level4">
<h4><span class="header-section-number">6.10.1.1</span> Answer</h4>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># not super necessary but to simplify</span>
<span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Egypt&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">max_gdp =</span> <span class="kw">max</span>(gdp))

<span class="co">## you can also create multiple variables within the same mutate(), and line them up so they are easier to read:</span>
gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># not super necessary but to simplify</span>
<span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Vietnam&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp     =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap,
         <span class="dt">max_gdp =</span> <span class="kw">max</span>(gdp))</code></pre>
<p>With the things we know so far, the answers you have are maybe a bit limiting. First, we had to act on Egypt and Vietnam separately, and repeat the same code. Copy-pasting like this is also super error prone.</p>
<p>And second, this <code>max_gdpPercap</code> column is pretty redundant, because it’s a repeated value a ton of times. Sometimes this is exactly what you want! You are now set up nicely to maybe take a proportion of gdpPercap/max_gdpPercap for each year or something. But maybe you only wanted that <code>max_gdpPercap</code> for something else. Let’s keep going…</p>
</div>
</div>
</div>
<div id="group_by-operates-on-groups" class="section level2">
<h2><span class="header-section-number">6.11</span> <code>group_by()</code> operates on groups</h2>
<p>Let’s tackle that first issue first. So how do we less painfully calculate the max gdpPercap for all countries?</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<p><img src="img/rstudio-cheatsheet-group_by.png" /></p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp     =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap,
         <span class="dt">max_gdp =</span> <span class="kw">max</span>(gdp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># if you use group_by, also use ungroup() to save heartache later</span></code></pre>
<p>So instead of filtering for a specific country, we’ve grouped by country, and then done the same operations. It’s hard to see; let’s look at a bunch at the tail:</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp     =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap,
         <span class="dt">max_gdp =</span> <span class="kw">max</span>(gdp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tail</span>(<span class="dv">30</span>)</code></pre>
<p>OK, this is great. But what if this what we needed, a max_gdp value for each country. We don’t need that kind of repeated value for each of the max_gdp values. Here’s the next function:</p>
<div id="summarize-with-group_by" class="section level3">
<h3><span class="header-section-number">6.11.1</span> <code>summarize()</code> with <code>group_by()</code></h3>
<p>We want to operate on a group, but actually collapse or distill the output from that group. The <code>summarize()</code> function will do that for us.</p>
<p>Visually, we are doing this (thanks RStudio for your <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a>):</p>
<p><img src="img/rstudio-cheatsheet-summarise.png" />
Here we go:</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">max_gdp =</span> <span class="kw">max</span>(gdp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()</code></pre>
<p>How cool is that! <code>summarize()</code> will actually only keep the columns that are grouped_by or summarized. So if we wanted to keep other columns, we’d have to do have a few more steps (we’ll get into it tomorrow).</p>
</div>
</div>
<div id="arrange-orders-columns" class="section level2">
<h2><span class="header-section-number">6.12</span> <code>arrange()</code> orders columns</h2>
<p>This is ordered alphabetically, which is cool. But let’s say we wanted to order it in ascending order for <code>max_gdp</code>. The dplyr function is <code>arrange()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">max_gdp =</span> <span class="kw">max</span>(gdp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(max_gdp)</code></pre>
<div id="your-turn-7" class="section level3">
<h3><span class="header-section-number">6.12.1</span> Your turn</h3>
<ol style="list-style-type: decimal">
<li>arrange your data frame in descending order (opposite of what we’ve done). Expect that this is possible: <code>?arrange</code></li>
<li>save your data frame as a variable</li>
<li>find the maximum life expectancy for countries in Asia. What is the earliest year you encounter? The latest? Hint: you can use or <code>base::max</code> and <code>dplyr::arrange()</code>…</li>
<li>Knit your RMarkdown file, and sync it to GitHub (pull, stage, commit, push)</li>
</ol>
<div id="answer-no-peeking" class="section level4">
<h4><span class="header-section-number">6.12.1.1</span> Answer (no peeking!)</h4>
<pre class="sourceCode r"><code class="sourceCode r">gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &#39;Asia&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(lifeExp <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(lifeExp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(year) </code></pre>
</div>
</div>
</div>
<div id="all-together-now" class="section level2">
<h2><span class="header-section-number">6.13</span> All together now</h2>
<p>We have done a pretty incredible amount of work in a few lines. Our whole analysis is this. Imagine the possibilities from here. It’s very readable: you see the data as the first thing, it’s not nested. Then, you can read the verbs. This is the whole thing, with explicit package calls from <code>readr::</code> and <code>dplyr::</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## gapminder-wrangle.R</span>
<span class="co">## J. Lowndes lowndes@nceas.ucsb.edu</span>


<span class="co">## load libraries</span>
<span class="kw">library</span>(tidyverse) <span class="co">## install.packages(&#39;tidyverse&#39;)</span>

<span class="co">## read in data</span>
gapminder &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/gapminder.csv&#39;</span>) 

<span class="co">## summarize</span>
gap_max_gdp &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># or select(country, year, pop, gdpPercap)</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarize</span>(<span class="dt">max_gdp =</span> <span class="kw">max</span>(gdp)) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">ungroup</span>() </code></pre>
<p>I actually am borrowing this “All together now” from Tony Fischetti’s blog post <a href="http://www.statsblogs.com/2014/02/10/how-dplyr-replaced-my-most-common-r-idioms/">How dplyr replaced my most common R idioms</a>). With that as inspiration, this is how what we have done would look like in Base R.</p>
<div id="compare-to-base-r" class="section level3">
<h3><span class="header-section-number">6.13.1</span> Compare to base R</h3>
<p>Let’s compare with some base R code to accomplish the same things. Base R requires subsetting with the <code>[rows, columns]</code> notation. This notation is something you’ll see a lot in base R. the brackets <code>[ ]</code> allow you to extract parts of an object. Within the brackets, the comma separates rows from columns.</p>
<p>If we don’t write anything after the comma, that means “all columns”. And if we don’t write anything before the comma, that means “all rows”.</p>
<p>Also, the <code>$</code> operator is how you access specific columns of your dataframe. You can also add new columns like we will do with <code>mex$gdp</code> below.</p>
<p>Instead of calculating the max for each country like we did with <code>dplyr</code> above, here we will calculate the max for one country, Mexico. Tomorrow we will learn how to do it for all the countries, like we did with <code>dplyr::group_by()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## gapminder-wrangle.R --- baseR</span>
<span class="co">## J. Lowndes lowndes@nceas.ucsb.edu</span>


gapminder &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/gapminder.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) 
x1  &lt;-<span class="st"> </span>gapminder[ , <span class="kw">c</span>(<span class="st">&#39;country&#39;</span>, <span class="st">&#39;year&#39;</span>, <span class="st">&#39;pop&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>) ]<span class="co"># subset columns</span>
mex &lt;-<span class="st"> </span>x1[x1<span class="op">$</span>country <span class="op">==</span><span class="st"> &quot;Mexico&quot;</span>, ] <span class="co"># subset rows</span>
mex<span class="op">$</span>gdp &lt;-<span class="st"> </span>mex<span class="op">$</span>pop <span class="op">*</span><span class="st"> </span>mex<span class="op">$</span>gdpPercap <span class="co"># add new columns</span>
mex<span class="op">$</span>max_gdp &lt;-<span class="st"> </span><span class="kw">max</span>(mex<span class="op">$</span>gdp)</code></pre>
<p>Note too that the chain operator <code>%&gt;%</code> that we used with the <code>tidyverse</code> lets us get away from the temporary variable x1.</p>
<!---https://twitter.com/bencapistrant/status/932646247101534209--->
</div>
<div id="your-turn-8" class="section level3">
<h3><span class="header-section-number">6.13.2</span> Your Turn</h3>
<p>Get your RMarkdown file cleaned up and sync it for the last time today!</p>
<div id="answers" class="section level4">
<h4><span class="header-section-number">6.13.2.1</span> Answers</h4>
<p>…</p>
</div>
</div>
</div>
<div id="joining-datasets" class="section level2">
<h2><span class="header-section-number">6.14</span> Joining datasets</h2>
<p>We’ve learned a ton in this session and we may not get to this right now. If we don’t have time, we’ll start here before getting into the next chapter: <code>tidyr</code>).</p>
<p>Most of the time you will have data coming from different places or in different files, and you want to put them together so you can analyze them. Datasets you’ll be joining can be called relational data, because it has some kind of relationship between them that you’ll be acting upon. In the tidyverse, combining data that has a relationship is called “joining”.</p>
<p>From the <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">RStudio cheatsheet</a> (note: this is an earlier version of the cheatsheet but I like the graphics):</p>
<p><img src="img/rstudio-cheatsheet-combine.png" /></p>
<p><br>
Let’s have a look at this and pretend that the x1 column is a study site and x2 is the variables we’ve recorded (like species count) and x3 is data from an instrument (like temperature data). Notice how you may not have exactly the same observations in the two datasets: in the x1 column, observations A and B appear in both datasets, but notice how the table on the left has observation C, and the table on the right has observation D.</p>
<p>If you wanted to combine these two tables, how would you do it? There are some decisions you’d have to make about what was important to you. The cheatsheet visualizes it for us:</p>
<p><img src="img/rstudio-cheatsheet-combine-options1.png" /></p>
<p>We will only talk about this briefly here, but you can refer to this more as you have your own datasets that you want to join. This describes the figure above::</p>
<ul>
<li><code>left_join</code> keeps everything from the left table and matches as much as it can from the right table. In R, the first thing that you type will be the left table (because it’s on the left)</li>
<li><code>right_join</code> keeps everything from the right table and matches as much as it can from the left table</li>
<li><code>inner_join</code> only keeps the observations that are similar between the two tables</li>
<li><code>full_join</code> keeps all observations from both tables.</li>
</ul>
<!---
These are all "mutating joins" because they add another column to what had been there previously. There are also "filtering joins" that do not add another column: 

- `semi_join` keeps only the observations that are in both tables
- `anti_join` keeps only the observations that are NOT in both tables.
--->
<p>Let’s play with <a href="http://edgar.jrc.ec.europa.eu/news_docs/CO2_1970-2014_dataset_of_CO2_report_2015.xls">these</a> CO2 emissions data to illustrate:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## read in the data. (same URL as yesterday, with co2.csv instead of gapminder.csv)</span>
co2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/co2.csv&quot;</span>)

<span class="co">## explore</span>
co2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()
co2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dim</span>() <span class="co"># 12</span>

<span class="co">## create new variable that is only 2007 data</span>
gap_<span class="dv">2007</span> &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) 
gap_<span class="dv">2007</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dim</span>() <span class="co"># 142  </span>

<span class="co">## left_join gap_2007 to co2</span>
lj &lt;-<span class="st"> </span><span class="kw">left_join</span>(gap_<span class="dv">2007</span>, co2, <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>)

<span class="co">## explore</span>
lj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dim</span>() <span class="co">#142</span>
lj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>() <span class="co"># lots of NAs in the co2_2017 columm</span>
lj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">View</span>() 

<span class="co">## right_join gap_2007 and co2</span>
rj &lt;-<span class="st"> </span><span class="kw">right_join</span>(gap_<span class="dv">2007</span>, co2, <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>)

<span class="co">## explore</span>
rj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dim</span>() <span class="co"># 12</span>
rj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()
rj <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">View</span>() </code></pre>
<p>That’s all we’re going to talk about today with joining, but there are more ways to think about and join your data. Check out the <a href="http://r4ds.had.co.nz/relational-data.html">Relational Data Chapter</a> in <a href="http://r4ds.had.co.nz">R for Data Science</a>.</p>
</div>
<div id="key-points" class="section level2">
<h2><span class="header-section-number">6.15</span> Key Points</h2>
<ul>
<li>Data manipulation functions in <code>dplyr</code> allow you to <code>filter()</code> by rows and <code>select()</code> by columns, create new columns with <code>mutate()</code>, and <code>group_by()</code> unique column values to apply <code>summarize()</code> for new columns that define aggregate values across groupings.</li>
<li>The “then” operator <code>%&gt;%</code> allows you to chain successive operations without needing to define intermediary variables for creating the most parsimonious, easily read analysis.</li>
</ul>
</div>
<div id="troubleshooting." class="section level2">
<h2><span class="header-section-number">6.16</span> Troubleshooting.</h2>
<div id="error-unexpected-special-in" class="section level3">
<h3><span class="header-section-number">6.16.1</span> Error: unexpected SPECIAL in &quot; %&gt;%&quot;</h3>
<p>If you get this error, it is probably because you have a line that starts with a pipe. The pipe should be at the end of the previous line, not the start of the current line.</p>
<p>Yes:</p>
<pre class="sourceCode r"><code class="sourceCode r">gap_cambodia  &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp)</code></pre>
<p>No:</p>
<pre class="sourceCode r"><code class="sourceCode r">gap_cambodia  &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>) 
  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>continent, <span class="op">-</span>lifeExp)
<span class="co"># Error: unexpected SPECIAL in &quot;  %&gt;%&quot;</span></code></pre>

</div>
</div>
</div>
<script src="lib/js/jquery.min.js"></script>
<script src="lib/js/bootstrap.min.js"></script>
<script src="lib/js/lesson.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="ggplot2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/OHI-Science/data-science-training/edit/master/dplyr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["data-science-training.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
